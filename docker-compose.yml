version: '3.8'

services:
  dvswitch:
    build:
      context: .
      dockerfile: Dockerfile
    image: dvswitch-server:latest
    container_name: dvswitch-server
    restart: unless-stopped
    hostname: dvswitch
    
    # Network mode - use host for direct network access (recommended for DVSwitch)
    # Alternatively, use bridge mode with port mappings
    network_mode: bridge
    
    ports:
      # MMDVM Bridge UDP ports
      - "62030:62030/udp"
      - "62031:62031/udp"
      - "62032:62032/udp"
      # USRP ports
      - "34001:34001/udp"
      - "32001:32001/udp"
      # Dashboard web interface (if enabled)
      - "8080:80"
    
    volumes:
      # Standard DVSwitch directories
      - mmdvm-bridge:/opt/MMDVM_Bridge
      - analog-bridge:/opt/Analog_Bridge
      - analog-reflector:/opt/Analog_Reflector
      # Persistent logs
      - mmdvm-logs:/var/log/mmdvm
    
    environment:
      - TZ=UTC
    
    # Health check - verify container is running and responsive
    healthcheck:
      test: ["CMD-SHELL", "test -d /opt/MMDVM_Bridge || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  mmdvm-bridge:
    driver: local
  analog-bridge:
    driver: local
  analog-reflector:
    driver: local
  mmdvm-logs:
    driver: local
